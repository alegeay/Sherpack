{# ============================================
   SERVICE - DÃ©monstration boucles, conditions
   ============================================ #}

apiVersion: v1
kind: Service
metadata:
  name: {{ release.name }}
  namespace: {{ release.namespace }}
  labels:
    app.kubernetes.io/name: {{ release.name }}
    {# Utilisation de ternary pour valeur conditionnelle #}
    environment: {{ ternary("prod", "non-prod", release.namespace == "production") }}
spec:
  type: ClusterIP
  selector:
    app.kubernetes.io/name: {{ release.name }}
  ports:
    {#- Boucle avec index -#}
    {% for p in values.ports %}
    - name: {{ p.name }}
      port: {{ p.port }}
      targetPort: {{ p.targetPort }}
      protocol: TCP
    {% endfor %}
